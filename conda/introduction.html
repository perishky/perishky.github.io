<!DOCTYPE html>
<html>
  <head>
    <title>Introduction to CONDA</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="my-remark.css">
    <style>
	  .box{
        margin-left: 5%;
        margin-right: 5%;
        background-color: #f0f0e0;
        padding: 10px;
      }
      .quote{
        margin-left: 5%;
        margin-right: 5%;
        background-color: #f0f0e0;
        padding: 10px;
        border-left: 2px solid gray;
        border-collapse: collapse; 
      }
      .rightmid {
        display: block;
        position: absolute;
        top: 50%;
        right: 2%;
        transform: translate(50%, -50%);
        float: right;
      }
      .popup {
        display: block;
        position: absolute;
        top: 40%;
        right: 40%;
        transform: translate(50%, 50%);
      }
    </style>
  </head>
  <body>
    <textarea id="source">

count: false
class: left, bottom

# Introduction to using CONDA
&nbsp;
### Matthew Suderman
#### Senior Lecturer in Epigenetic Epidemiology
#### July 11, 2022

&lt;img src="IEU-logo-colour.png" width="50%"&gt;
---
layout: true

.logo[.mrcieu[
MRC Integrative Epidemiology Unit&nbsp;&nbsp;&nbsp;&nbsp;
]]

---

<img src="https://docs.conda.io/projects/conda/en/4.6.1/_images/conda_logo.svg"/>

CONDA is a management system that allows you to install and switch between different versions 
of programming environments (e.g. Python, R, C/C++).

https://conda.io/projects/conda/en/latest/user-guide/index.html

--

For example, my linux account:

```bash
(base)$ conda info --envs

# conda environments:
#
base                  *  /data/ms13525/lib/miniconda2
r36                      /data/ms13525/lib/miniconda2/envs/r36
r413                     /data/ms13525/lib/miniconda2/envs/r413
```

By default, I am using the 'base' environment. 

However, I have an environment with R v3.6 and another with R v4.13

---

## Selecting a different environment

In my base environment, I have R v3.6.3:
```bash
(base)$ R
R version 3.6.3 (2020-02-29) -- "Holding the Windsock"
...
```
--

However, I can activate the environment with a more recent version of R.
```bash
(base)$ conda activate r413
```
--
```bash
(r413)$ R
R version 4.1.3 (2022-03-10) -- "One Push-Up"
...
```
---

## Setting up CONDA -- part 1

.quote[**Note**: the following assumes bluecrystal (bc4) or bluepebble (bp).]

To use CONDA, 
it must be initialised *one* time.
After this, it will always be ready for use.
--
Load the 'anaconda' module. 
```bash
module add languages/anaconda3/2020-3.8.5
```
--
See what other versions are available:
```bash
module avail anaconda
```
--
Initialise CONDA:
```bash
conda init bash
```
--
.quote[*Before* doing anything else, you will need to log out and then log back in.]

---

## Setting up CONDA -- part 2

Tell CONDA to look for software packages on the `conda-forge` channel.

```bash
conda config --add channels conda-forge
```

Other channels are possible, but `conda-forge` is free!
--

Finally, searching package channels can be slow.
Tell CONDA to search faster by just returning the first matching package it finds.
```bash
conda config --set channel_priority strict
```
--

CONDA is ready to use and never needs to be initialised again!

---

## Create an environment

For this example, we'll create an environment we'll call 'rmagick'
and then: 
* install R version 4.2.0 
* add R package `magick` (for advanced image processing)

--

Create an environment named 'rmagick'
```bash
conda create --name rmagick
```

---

## Preparing to install packages

Before installing, ensure that the 'rmagick' environment is active.
```bash
conda activate rmagick
```
--

.quote[
There's no point installing a package if it is already available 
as a module. 

Check what versions of R are available as modules as follows:
```bash 
module avail languages/r
```

If R v4.2.0 is available as module, then there's no need to install it, 
just load the module.
```bash
module add languages/r/4.2.0
```
]

--
Before trying to install the package, 
best to ensure that it actually exists. 
```bash
conda search r-base
```
You could also look them up online: https://anaconda.org/conda-forge/repo
---

## Installing packages

Assuming that R v4.2.0 is available, then install it.
```bash
conda install r-base=4.2.0
```
--

The R package 'magick' assumes that the 'imagemagick' libraries 
are installed, so install them.

```bash
conda install imagemagick
```
--

Finally, install the 'magick' R package.
```bash
R
> install.packages("magick")
```

---

## Other CONDA commands

Show packages installed in the current environment
```bash
  conda list
```

Show revisions that have been made to the current environment
```bash
  conda list --revisions
```

Revert back to a previous state
```bash
  conda install --revision <revision number>
```

Update a list of CONDA packages to the most recent version.
```bash
  conda update <packages>
```

For a more complete list of typical commands:

https://docs.conda.io/projects/conda/en/latest/user-guide/cheatsheet.html

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
    <script src="slideshow.js"></script>
  </body>
</html>      
