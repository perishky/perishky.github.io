})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
quantile((stats[,ncol(stats)]))
rnorm(10,sd=5)
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=5)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.1))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=5)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=10)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
quantile((stats[,ncol(stats)]))
pheno.dat$bmi
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=20)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
sum(p.adjust(stats[,ncol(stats)]))
sum(p.adjust(stats[,ncol(stats)]) < 0.05)
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=20)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=20)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=20)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=20)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=50)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=50)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=50)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(n,sd=50)*bmi + rnorm(n,sd=0.5)*diet + rnorm(n,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
rnorm(n,sd=50)
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(1,sd=1)*bmi + rnorm(1,sd=0.5)*diet + rnorm(1,sd=5)*sign(sex=="M") + rnorm(n,sd=0.05))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(1,sd=1)*bmi + rnorm(1,sd=0.5)*diet + rnorm(1,sd=5)*sign(sex=="M") + rnorm(n,sd=1))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(1,sd=0.5)*bmi + rnorm(1,sd=0.5)*diet + rnorm(1,sd=5)*sign(sex=="M") + rnorm(n,sd=1))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(1,sd=0.5)*bmi + rnorm(1,sd=0.5)*diet + rnorm(1,sd=5)*sign(sex=="M") + rnorm(n,sd=1))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
n <- nrow(pheno.dat)
gene.dat <- t(sapply(1:100, function(i) {
with(pheno.dat, rnorm(1,sd=0.5)*bmi + rnorm(1,sd=0.5)*diet + rnorm(1,sd=5)*sign(sex=="M") + rnorm(n,sd=1))
}))
rownames(gene.dat) <- paste0("gene", 1:nrow(gene.dat))
colnames(gene.dat) <- pheno.dat$id
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
gene.dat[5,10] <- NA
gene.dat[10,]
gene.dat[10,] <- scale(gene.dat[10,])*1e-6 + 2
gene.dat[10,]
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
gene.dat[10,] <- 1.2
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
gene.dat[10,] <- NA
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
pheno.dat[5,"bmi"] <- NA
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
gene.dat[10,] <- 2
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
gene.dat[10,] <- NA
gene.dat[10,1] <- 2
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
gene.dat[10,c(1,10)] <- 2
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
stats
gene.dat[5,] <- NA
gene.dat[10,c(1,10)] <- 2.003
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
stats
dim(stats)
gene.dat[5,] <- NA
gene.dat[10,c(1,10)] <- 2.003
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
write.csv(pheno.dat, file="pheno-dat.csv")
write.csv(gene.dat, file="gene-dat.csv")
pheno.dat
pheno.dat <- read.csv("pheno-dat.csv")
gene.dat <- read.csv("gene-dat.csv")
stats <- sapply(rownames(gene.dat), function(gene) {
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
stats[1,]
dim(stats)
pheno.dat <- read.csv("pheno-dat.csv")
gene.dat <- read.csv("gene-dat.csv")
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coeff(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
quantile(p.adjust(stats[,ncol(stats)]),na.rm=T)
stats
rownames(gene.dat)
gene.dat[1:5,1:5]
pheno.dat <- read.csv("pheno-dat.csv")
gene.dat <- read.csv("gene-dat.csv",row.names=1)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coeff(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
stats
gene.dat[1,]
rownames(gene.dat)
pheno.dat[1:5,]
pheno.dat <- read.csv("pheno-dat.csv",row.names=1)
gene.dat <- read.csv("gene-dat.csv",row.names=1)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coeff(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
stats
gene
gene <- "gene1"
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
gene.dat[,gene]
gene.dat[gene,]
length(gene.dat[gene,g])
length(gene.dat[gene,])
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
class(gene.dat[1,])
pheno.dat <- read.csv("pheno-dat.csv",row.names=1)
gene.dat <- read.csv("gene-dat.csv",row.names=1)
gene.dat <- as.matrix(gene.dat)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coeff(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
stats
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
fit
pheno.dat <- read.csv("pheno-dat.csv",row.names=1)
gene.dat <- read.csv("gene-dat.csv",row.names=1)
gene.dat <- as.matrix(gene.dat)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
quantile(p.adjust(stats[,ncol(stats)]))
stats
pheno.dat <- read.csv("pheno-dat.csv",row.names=1)
gene.dat <- read.csv("gene-dat.csv",row.names=1)
gene.dat <- as.matrix(gene.dat)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
colnames(stats) <- c("estimate","se","t","p.value")
cat("The strongest association is:\n")
idx <- which.min(stats[,"p.value"])
cat("gene:", rownames(stats)[idx])
pheno.filename <- "pheno-dat.csv"
gene.filename <- "gene-dat.csv"
top.n <- 5
pheno.dat <- read.csv(pheno.filename,row.names=1)
gene.dat <- read.csv(gene.filename,row.names=1)
gene.dat <- as.matrix(gene.dat)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
colnames(stats) <- c("estimate","se","t","p.value")
cat("The strongest association is:\n")
idx <- which.min(stats[,"p.value"])
cat("gene:", rownames(stats)[idx], "\n")
cat("effect=", round(stats[,"estimate"],2), "\n")
cat("p=", round(stats[,"p.value"],2), "\n")
top.idx <- order(stats[,"p.value"])[1:top.n]
cat("The top 5 genes:", paste(rownames(stats)[top.idx], collapse=","), "\n")
pheno.filename <- "pheno-dat.csv"
gene.filename <- "gene-dat.csv"
top.n <- 5
pheno.dat <- read.csv(pheno.filename,row.names=1)
gene.dat <- read.csv(gene.filename,row.names=1)
gene.dat <- as.matrix(gene.dat)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
colnames(stats) <- c("estimate","se","t","p.value")
cat("The strongest association is:\n")
idx <- which.min(stats[,"p.value"])
cat("gene:", rownames(stats)[idx], "\n")
cat("effect=", round(stats[idx,"estimate"],2), "\n")
cat("p=", round(stats[idx,"p.value"],2), "\n")
top.idx <- order(stats[idx,"p.value"])[1:top.n]
cat("The top 5 genes:", paste(rownames(stats)[top.idx], collapse=","), "\n")
cat("p=", stats[idx,"p.value"], "\n")
pheno.filename <- "pheno-dat.csv"
gene.filename <- "gene-dat.csv"
top.n <- 5
pheno.dat <- read.csv(pheno.filename,row.names=1)
gene.dat <- read.csv(gene.filename,row.names=1)
gene.dat <- as.matrix(gene.dat)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
colnames(stats) <- c("estimate","se","t","p.value")
cat("The strongest association is:\n")
idx <- which.min(stats[,"p.value"])
cat("gene:", rownames(stats)[idx], "\n")
cat("effect=", round(stats[idx,"estimate"],2), "\n")
cat("p=", stats[idx,"p.value"], "\n")
plot(pheno.dat$bmi, gene.dat[idx,], pch=19, main=rownames(stats)[idx])
abline(lm(gene.dat[idx,]~pheno.dat$bmi), col="red")
top.idx <- order(stats[idx,"p.value"])[1:top.n]
cat("The top 5 genes:", paste(rownames(stats)[top.idx], collapse=","), "\n")
pheno.filename <- readline(prompt="Enter pheno data file: ")
top.n <- readline(prompt="Enter # top genes to show: ")
pheno.dat <- read.csv(pheno.filename,row.names=1)
gene.dat <- read.csv(gene.filename,row.names=1)
gene.dat <- as.matrix(gene.dat)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
colnames(stats) <- c("estimate","se","t","p.value")
cat("The strongest association is:\n")
idx <- which.min(stats[,"p.value"])
cat("gene:", rownames(stats)[idx], "\n")
cat("effect=", round(stats[idx,"estimate"],2), "\n")
cat("p=", stats[idx,"p.value"], "\n")
plot(pheno.dat$bmi, gene.dat[idx,], pch=19, main=rownames(stats)[idx])
abline(lm(gene.dat[idx,]~pheno.dat$bmi), col="red")
top.idx <- order(stats[idx,"p.value"])[1:top.n]
cat("The top 5 genes:", paste(rownames(stats)[top.idx], collapse=","), "\n")
pheno.filename <- readline(prompt="Enter pheno data file: ")
gene.filename <- readline(prompt="Enter gene data file: ")
top.n <- readline(prompt="Enter # top genes to show: ")
top.n <- as.integer(top.n)
top.n
pheno.dat <- read.csv(pheno.filename,row.names=1)
gene.dat <- read.csv(gene.filename,row.names=1)
gene.dat <- as.matrix(gene.dat)
stats <- sapply(rownames(gene.dat), function(gene) {
tryCatch({
fit <- lm(gene.dat[gene,] ~ bmi+diet+sex, pheno.dat)
coef(summary(fit))["bmi",]
}, error=function(e) rep(NA,4))
})
stats <- t(stats)
colnames(stats) <- c("estimate","se","t","p.value")
cat("The strongest association is:\n")
idx <- which.min(stats[,"p.value"])
cat("gene:", rownames(stats)[idx], "\n")
cat("effect=", round(stats[idx,"estimate"],2), "\n")
cat("p=", stats[idx,"p.value"], "\n")
plot(pheno.dat$bmi, gene.dat[idx,], pch=19, main=rownames(stats)[idx])
abline(lm(gene.dat[idx,]~pheno.dat$bmi), col="red")
top.idx <- order(stats[idx,"p.value"])[1:top.n]
cat("The top 5 genes:", paste(rownames(stats)[top.idx], collapse=","), "\n")
pheno.filename
gene.dat
gene.filename
pheno.filename
library(knitr)
library(markdown)
knit("practical.rmd", "practical.md")
markdown("practical.md", "practical.html")
markdown2HTML("practical.md", "practical.html")
markdownToHTML("practical.md", "practical.html")
knit("practical.rmd", "practical.md")
markdownToHTML("practical.md", "practical.html")
