<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <textarea id="source">

count: false
class: left, middle

.ii[
# Introduction to R
&nbsp;
### Matthew Suderman
#### Lecturer in Epigenetic Epidemiology

&lt;img src="img/IEU-logo-colour.png" width="50%"&gt;
]

.ii[&lt;img src="img/Rlogo.png" width="100%"&gt;]
---
layout: true

.logo[.mrcieu[
MRC Integrative Epidemiology Unit&nbsp;&nbsp;&nbsp;&nbsp;
]]

---

## What is R?

* R is a statistical programming language (based on S)
* R is open source - researchers develop packages to 
    implement new statistical methods, plots or applications
* R runs on Windows, MacOS and UNIX

.center[
.ii[
&lt;img src="img/john-chambers.jpg" width="50%"&gt;

John Chambers
]
.ii[
&lt;img src="img/dirk-eddelbuettel.jpg" width="50%" &gt;

Dirk Eddelbuettel
]]

---

## Why use R?

* R is free!
* R is flexible
* R is good at handling large datasets and multiple objects
* R has good plotting tools and packages for statistical analysis

---

## Downloading R

* Visit https://www.r-project.org and click "Download R"
* Choose your nearest CRAN mirror (such as http://www.stats.bris.ac.uk/R)
* Choose "Download R for [Windows/Mac/Linux]"
* Choose "base" for Windows and click on "Download R 3.5.2 for Windows"
* Choose "R-3.5.2.pkg" for Mac
* Once the .exe (Windows) or .pkg (Mac) have downloaded, run and install

---

## Opening R

* Click "Start" | "All Programs" | "R" | "R x64 3.6.0"

.center[
&lt;img src="img/windows.png" width="25%"&gt;
]

---

## R window

.ii[
&lt;img src="img/r-window.png" width="200%"&gt;
]

.ii[
&lt;br&gt;
&lt;br&gt;
* **Drop-down menus** are available
    but R cannot be used in a point-and-click fashion

* The **R console** initially just shows information 
    on the version of R running, how to get help and how to quit

* At the bottom of the console is the **R command line** where 
    you can tell R what to do
]

---

## R menu

.ii[
&lt;img src="img/r-menu.png" width="75%"&gt;
]

.ii[
* A **script** is sequence of R commands. 
Creating or opening a script will open
the script in a text editor.

* A **workspace** includes all the objects
which are in R’s memory at a given time.
These can include data or results. To see
what is in the current workspace type ls().

* The **history** includes all the commands
which are displayed during an R session
]

---

## RStudio

* RStudio makes R easier to use
* It includes a code editor, debugging & visualization tools
* https://www.rstudio.com

&lt;img src="img/rstudio.png" width="100%"&gt;

---

## RStudio script window

&lt;img src="img/rstudio-window.png" width="100%"&gt;

In the script window, you can **save a script** (disk image), **run** selected commands ("Run") and **run** the entire script ("Script").


---

## Getting help

* Use the command `help(topic)` or `?topic`
* In R this will open a web browser
* In RStudio this will open the Help tab

&lt;img src="img/help-search.png" width="100%"&gt;


---

## `help(mean)`
 
--

.smaller[
`mean {base}`

.larger[**Arithmetic Mean**]

**Description**

Generic function for the (trimmed) arithmetic mean.
]

--

.smaller[
**Usage**

`mean(x, ...)`

`## Default S3 method:`&lt;br&gt;
`mean(x, trim = 0, na.rm = FALSE, ...)`
]

--

.smaller[
**Arguments**

|||
:-:|:-:
|`x`|An R object. Currently there are methods for numeric/logical vectors and date, date-time and time interval objects. Complex vectors are allowed for trim = 0, only.|
|`trim`|the fraction (0 to 0.5) of observations to be trimmed from each end of x before the mean is computed. Values of trim outside that range are taken as the nearest endpoint.|
|`na.rm`|a logical value indicating whether NA values should be stripped before the computation proceeds.|
|...|further arguments passed to or from other methods.
]

--

.smaller[
**Value**

If `trim` is zero (the default), the arithmetic mean of the values in `x` is computed, as a numeric or complex vector of length one. If `x` is not `logical` (coerced to `numeric`), `numeric` (including `integer`) or `complex`, `NA_real_` is returned, with a warning.
]

--

.smaller[
**References**

Becker, R. A., Chambers, J. M. and Wilks, A. R. (1988) The New S Language. Wadsworth & Brooks/Cole.
]

--

.smaller[
**See Also**

`weighted.mean`, `mean.POSIXct`, `colMeans` for row and column means.
]

--

.smaller[
**Examples**

`x <- c(0:10, 50)`&lt;br&gt;
`xm <- mean(x)`&lt;br&gt;
`c(xm, mean(x, trim = 0.10))`
]

---

## Error messages

Suppose you type the following but variable 'a' has not been created.
```{r}
> 10*a
```
--

```{r}
Error: object 'a' not found
```

--

R provides informative error messages

--

.center[
&lt;img src="img/laughing.png" width="36px"&gt;]



---

## Online help

Notice:
* R Project | Search
* Help with R
* Manuals
* FAQs

.right[&lt;img src="img/r-project.png" width="60%"&gt;]

---

## Forums

* Mailing list archive and forum http://r.789695.n4.nabble.com
* Stack Overflow https://stackoverflow.com
* Google!

---

class: left, middle

## R basics
&lt;hr&gt;

variables, vectors, combining, matrices, data frames, lists, 
functions, logic, data types

---

## R basics: variables

A **variable** is a storage location for data with a name.

```{r}
> a <- 3
> b <- 4
```
--
```{r}
> a/b
```
--
```{r}
[1] 0.75
```
--
```{r}
> x
```
--
```{r}
Error: object 'x' not found
```
--
```{r}
> a <- "abc def"
```
--
```{r}
> class(a)
```
--
```{r}
[1] "character"
```

---

## R basics: vectors

A **vector** is a sequence of elements.

```{r}
> x <- c(11,12,13,14,15,16,17,18,19,20)
> x
```
--
```{r}
[1] 11 12 13 14 15 16 17 18 19 20
```
--
```{r}
> x[3]
```
--
```{r}
[1] 13
```
--
```{r}
> x[-2]
```
--
```{r}
[1] 11 13 14 15 16 17 18 19 20
```
--
```{r}
> length(x)
```
--
```{r}
[1] 10
```
---

## R basics: sub-vectors

```{r}
> x[c(1, 5, 7)]
```
--
```{r}
[1] 11 15 17
```
--
```{r}
> x[-c(1, 5, 7)]
```
--
```{r}
[1] 12 13 14 16 18 19 20
```
--
```{r}
> x[x>13]
```
--
```{r}
[1] 14 15 16 17 18 19 20
```

---

## R basics: `seq()`

```{r}
> x<-seq(0, 100, by=5)
> x
```
--
```{r}
[1] 0 5 10 15 20 25 30 35 40 45 50
[12] 55 60 65 70 75 80 85 90 95 100
```
--
```{r}
> length(x)
```
--
```{r}
[1] 21
```
--
```{r}
> x<-seq(0, 100, length=5)
> x
```
--
```{r}
[1] 0 25 50 75 100
```
---

## R basics: `rep()`

```{r}
> x<-c(1, 1, 1, 1, 1)
> x
```
--
```{r}
[1] 1 1 1 1 1
```
--
```{r}
> x<-rep(1, 5)
> x
```
--
```{r}
[1] 1 1 1 1 1
```
--
```{r}
> rep(c(1,2,3),4)
```
--
```{r}
[1] 1 2 3 1 2 3 1 2 3 1 2 3
```

---

## R basics: vector maths

```{r}
> x <- 1:5
```
--
```{r}
> x+1
```
--
```{r}
[1] 2 3 4 5 6
```
--
```{r}
> 3*x
```
--
```{r}
[1] 3 6 9 12 15
```
--
```{r}
> x/2
```
--
```{r}
[1] 0.5 1.0 1.5 2.0 2.5
```

---

## R basics: more vector maths

```{r}
> y <- 5:9
> x+y
```
--
```{r}
[1]  6  8 10 12 14
```
--
```{r}
> x-y
```
--
```{r}
[1] -4 -4 -4 -4 -4
```
--
```{r}
> x*y
```
--
```{r}
[1]  5 12 21 32 45
```
--
```{r}
> x/y
```
--
```{r}
[1] 0.2000000 0.3333333 0.4285714 0.5000000 0.5555556
```

---

## R basics: combining data

```{r}
> x <- rep(1,5)
> y <- c("A","B","A","B","C")
> z <- c(x, y)
> z
```
--
```{r}
[1] "1" "1" "1" "1" "1" "A" "B" "A" "B" "C"
```
--
```{r}
> cbind(x, y)
```
--
```{r}
       x   y
[1,] "1" "A"
[2,] "1" "B"
[3,] "1" "A"
[4,] "1" "B"
[5,] "1" "C"
```
--
```{r}
> rbind(x, y)
```
--
```{r}
[,1] [,2] [,3] [,4] [,5]
x "1" "1" "1" "1" "1"
y "A" "B" "A" "B" "C"
```

---

## R basics: matrices

A **matrix** is a set of elements laid out in rows and columns.

```{r}
> z <- matrix(c(x, y), nrow=5)
> z
```
--
```{r}
[,1] [,2]
[1,] "1" "A"
[2,] "1" "B"
[3,] "1" "A"
[4,] "1" "B"
[5,] "1" "C"
```
--
```{r}
> dim(z) ## dimensions
```
--
```{r}
[1] 5 2
```
--
```{r}
> t(z) ## transpose
```
--
```{r}
[,1] [,2] [,3] [,4] [,5]
[1,] "1" "1" "1" "1" "1"
[2,] "A" "B" "A" "B" "C"
```

---

## R basics: indexing matrices

```{r}
> z[,1]
```
--
```{r}
[1] "1" "1" "1" "1" "1"
```
--
```{r}
> z[1,2]
```
--
```{r}
[1] "A"
```
--
```{r}
> z[2,]
```
--
```{r}
[1] "1" "B"
```
--
```{r}
> z[c(1,3),2]
```
--
```{r}
[1] "A" "A"
```

---

## R basics: data frames

A **data frame** is a table consisting of vectors of a given length. 

```{r}
> d <- data.frame(a=x, b=y)
> d[2,]
```
--
```{r}
  a b
2 1 B
```
--
```{r}
> d$a
```
--
```{r}
[1] 1 1 1 1 1
```
--
```{r}
> class(d$a)
```
--
```{r}
[1] "numeric" 
```
--
```{r}
> class(d$b)
```
--
```{r}
[1] "character"
```
---

## R basics: lists

A **list** is like a vector, but it can contain
elements of different types.

```{r}
> y <- diag(2)
> w <- list(x=1, y=y, z="abc")
```
--
```{r}
w$y
```
--
```{r}
     [,1] [,2]
[1,]    1    0
[2,]    0    1
```

```{r}
names(r)
```
--
```{r}
[1] "x" "y" "z"
```

---
## R basics: functions

**Functions** are commands like `help`, `cor`, `median` that use inputs and R commands to generate outputs.

--

Users can write their own functions, e.g. a function for multiplication:

```{r}
multiply <- function(a, b) {
    res <- a*b
    return(res)
}
```
--
```{r}
> multiply(2,3)
[1] 6
```

---
## R basics: logical expressions

|Command|Operator|
--:|--
| And | `&` |
| Or | <code>&#10072;</code> |
| Not| `!` |
| Is equal to | `==` |
| Is not equal to | `!=` |
| Is less than | `<` |
| Is less than or equal to | `<=` |
| Is greater than | `>` |
| Is greater than or equal to | `>=` |

--

```{r}
> x <- 11:15
> x[3] == 13
[1] TRUE
> x[3] == 12
[1] FALSE
> x[3] < x[4]
[1] TRUE
```

---

## R basics: conditional statements

```{r}
if (score > 85) {
  grade <- "A"
} else {
  grade <- "F"
}
```
--
```{r}
grade <- ifelse(score > 85, "A", "F")
```
--
```{r}
if (score > 85) {
  grade <- "A"
} else if (score > 75)
  grade <- "B"
} else {
  grade <- "F"
}
```
--
```{r}
grade <- ifelse(score > 85, "A", ifelse(score > 75, "B", "F"))
```

---

## R basics: looping 

```{r}
s <- 0
for (i in c(1,2,3,4,5)) {
  s <- s + i
}
print(s)
```
--
```{r}
[1] 15
```
--
```{r}
s <- c()
for (i in 1:5) {
  s <- c(s, i*i)
}
print(s)
```
--
```{r}
[1] 1 4 9 16 25
```
--
```{r}
sq <- function(i) {
  return(i*i)
}
s <- sapply(1:5, sq)
print(s)
```

---

## R basics: data type operators

|Command |Operator |
:--|:--
|Is missing? | `is.na(x)` |
|Is not missing?|`!is.na(x)`|
|Is numeric? | `is.numeric(x)` |
|Is character string? | `is.character(x)`|
|Make numeric | `as.numeric(x)` |
|Make character string | `as.character(x)` |

```{r}
> x <- 1:5
> x[3] <- NA
> x
[1] 1 2 NA 4 5
> is.na(x[2])
[1] FALSE
> is.na(x[3])
[1] TRUE
> is.numeric(x[1])
[1] TRUE
> as.character(x[1])
[1] "1"
```

---

## R basics: useful functions

| Command | Operator |
:--|:--
|Addition, subtraction, multiplication and division|`+`, `-`, `*`, `/`|
|Matrix operations: transpose, inverse, multiplication|`t`, `solve`, `%*%`|
|List R objects in session | `ls`|
|Class, length and dimensions | `class`, `length`, `dim`|
|Paste | `paste`|
|Row and column names (matrices)|`rownames`, `colnames`|
|Row and column names (data frames)|`rownames`, `names`|
|Combine, row bind and column bind|`c`, `rbind`, `cbind`|
|Subset dataset|`subset`|

---

class: left, middle

## Files
&lt;hr&gt;

finding files, reading files, saving files, file types

---

## Files: working directory

To open files, you will need to tell R where the files are. 
To do this, it helps to know where R will start looking.
This is called the 'working directory'.

```{r}
> getwd()
[1] "C:/"
```

You can change this using `setwd`.

```{r}
> setwd("O:/Documents")
```

The working directory can also be
chosen using the Session menu in RStudio.

---
## Files: reading data - csv

`read.csv` will read csv files and save them as data frames.

```{r}
> dat <- read.csv("bmi.csv")
```

```{r}
> dat
   id  age  bmi sex diet
1   1 32.0 25.0   M    0 
2   2 35.0 32.0   M    0
3   3 41.0 27.0   M    0
4   4 29.0 29.0   M    0
5   5 33.5 28.0   M    1
6   6 33.2 29.1   M    1
7   7 32.9 29.4   M    1
8   8 32.6 29.7   F    1
9   9 32.3 30.0   F    1
10 10 32.0 30.3   F    1
```

```{r}
> dat$bmi
[1] 25.0 32.0 27.0 29.0 28.0 29.1 29.4 29.7 30.0 30.3
> dat[5,]
   id  age  bmi sex diet
5   5 33.5 28.0   M    1
```
---

## Files: saving data - csv

`write.csv` saves a data frame as a csv file.

```{r}
> dat$sex[4] <- "F" ## make correction
> write.csv(dat, "bmi-corrected.csv", row.names=F, quote=F)
```

`write.table` is similar but allows the user to change the column separator 
character.

```{r}
> write.table(data_bmi, "bmi-corrected.csv", row.names=F, quote=F, sep=",")
```
---

class: left, middle

## Statistical analysis
&lt;hr&gt;

basic functions, summaries, correlation, regression

---
## > BASIC FUNCTIONS
> mean(data_bmi$bmi)
[1] 30.45
> median(data_bmi$bmi)
[1] 30.75
> sd(data_bmi$bmi)
[1] 2.124419
> min(data_bmi$bmi)
[1] 25
> max(data_bmi$bmi)
[1] 33.3
> quantile(data_bmi$bmi, probs=0.25)
25% 29.325

Mean
Median

Standard deviation
Minimum
Maximum

Lower quartile

---
## > SUMMARISE DATA
> summary(data_bmi$bmi)
Min. 1st Qu. Median Mean 3rd Qu. Max.
25.00 29.32 30.75 30.45 32.02 33.30
>
> summary(data_bmi)
id
age
bmi
min.
: 1.00
Min. :29.00
Min. :25.00
1st Qu.: 5.75 1st Qu.:30.12 1st Qu.:29.32
Median :10.50 Median :31.55 Median :30.75
Mean
:10.50
Mean :31.85
Mean :30.45
3rd Qu.:15.25 3rd Qu.:32.67 3rd Qu.:32.02
Max.
:20.00
Max. :41.00
Max. :33.30
>
> table(data_bmi$sex)
F M
13 7

summary can be used on a variable
or the whole dataset

sex
F:13
M: 7

diet
Min. :0.00
1st Qu.:0.00
Median :1.00
Mean :0.55
3rd Qu.:1.00
Max. :1.00

---

## > CORRELATION AND REGRESSION
> cor(data_bmi$bmi, data_bmi$age)
[1] -0.56091
>
>
> model <- lm(bmi~age, data=data_bmi)
> model
Call:
lm(formula = bmi ~ age, data = data_bmi)
Coefficients:
(Intercept)
44.5249

age
-0.4419

Pearson correlation
between bmi and age
Linear regression for outcome
bmi and exposure age

Intercept and slope estimates from
the regression

---

## > SUMMARISE REGRESSION MODELS
summary gives you more information on the

> summary(model)
regression model
Call:
lm(formula = bmi ~ age, data = data_bmi)
Residuals:
Min 1Q Median 3Q Max
-5.3837 -0.4604 0.3349 0.9627 2.9420

Coefficients:
Estimate
(Intercept) 44.5249
age
-0.4419
--Signif. codes: 0 ‘***’

Std. Error
4.9131
0.1537

t value
9.063
-2.875

Pr(>|t|)
3.97e-08 ***
0.0101 *

0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

---

## > USING RESULTS
names function allows us to see the
various components within "model"

> names(model)
[1] "coefficients" "residuals" "effects" "rank"
[5] "fitted.values" "assign" "qr" "df.residual"
[9] "xlevels" "call" "terms" "model"
> names(summary(model))
[1] "call" "terms" "residuals" "coefficients"
[5] "aliased" "sigma" "df" "r.squared"
[9] "adj.r.squared" "fstatistic"
"cov.unscaled"
> model$coefficients
(Intercept)
age
The $ command allows us to extract
44.524864
-0.441911

a component within "model"

---

class: left, middle

## Plots
&lt;hr&gt;

scatterplot, histogram, boxplot, saving plots

---

## > SCATTERPLOT

x is a vector of the
numbers 1 to 100

y is x squared
plot(x,y) produces
a scatterplot

---

## > HISTOGRAM

x is a vector of the
numbers 1 to 100

y is x squared
hist(y) produces a
histogram of y

---

## > BOXPLOT

x is a vector of the
numbers 1 to 100

boxplot(x)
produces a box
plot of x

---

## > SAVING PLOTS - DRIECTLY

---

## > SAVING PLOTS - INLINE
Opens a device in which to save
the plot (in this case a .png file)

> x<-1:100
>
> png(filename="example_boxplot.png", width=10, height=10,
units="cm", res=500)
>
> boxplot(x)
Create plot
>
> dev.off()
null device
Once the plot is complete we
1
close the device

---

class: left, middle

## Packages
&lt;hr&gt;

installing, loading, help, swirl, ggplot2, rmarkdown, shiny

---

## > INSTALLING PACKAGES
> install.packages("Hmisc")

Install packages

Installing package into ‘O:/Documents/R/win-library/3.5’
(as ‘lib’ is unspecified)

also installing the dependencies ‘backports’, ‘scales’, ‘checkmate’,
‘viridisLite’, ‘survival’, ‘ggplot2’, ‘htmlTable’, ‘viridis’
.

.
.
package ‘Hmisc’ successfully unpacked and MD5 sums checked
The downloaded binary packages are in < path >

---

## > LOADING PACKAGES
> library(Hmisc)
Loading required
Loading required
Loading required
Loading required

package:
package:
package:
package:

lattice
survival
Formula
ggplot2

Command to load the Hmisc
package into our current R session

Attaching package: ‘Hmisc’

The following objects are masked from ‘package:base’:
format.pval, round.POSIXt, trunc.POSIXt, units

---

## > HELP FOR PACKAGES
* The help function can be used to open the documentation for an R
package, e.g. help(package="Hmisc")
* Search the package list on CRAN https://cran.r-project.org

---
## > LEARN R - SWIRL
> install.packages("swirl")
> library(swirl)
| Hi! Type swirl() when you are ready to begin.

swirl (http://swirlstats.com/students.html)
allows you to learn R within R itself

---

## ACKNOWLEDGMENTS

Slides were based on work by these beautiful minds.

.center[
.iii[
&lt;img src="img/harriet-mills.jpg" width="90%"&gt;

Harriet Mills

University of Bristol
]
.iii[
&lt;img src="img/andrew-simpkin.jpg" width="70%"&gt;

Andrew Simpkin

National University of Ireland
]
.iii[
&lt;img src="img/james-staley.jpg" width="90%"&gt;

James Staley

UCB
]
]

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
    <script src="slideshow.js"></script>
  </body>
</html>      
 
